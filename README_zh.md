# ThreeToTwo 插件 - 三渲二工具

## 概述

ThreeToTwo 是一个 Godot 引擎插件，专门用于将 3D 模型渲染为 2D 贴图（三渲二）。该插件提供了完整的 3D 模型导入、预览、编辑和导出功能，特别适合游戏开发中的角色、道具等资源的 2D 化处理。

### 主要功能

- **3D 模型导入** - 支持 FBX、GLTF、GLB、OBJ 等主流 3D 格式
- **实时预览** - 在插件窗口中实时查看 3D 模型渲染效果
- **相机控制** - 支持鼠标和键盘控制相机视角
- **灯光控制** - 调整环境光和定向光，支持控制模式切换
- **材质切换** - 在普通材质和法线材质之间切换
- **动画控制** - 播放和控制 3D 模型动画
- **贴图导出** - 将 3D 模型渲染为 2D 贴图导出
- **批量导出** - 按时间间隔批量导出动画帧
- **多语言支持** - 支持中文和英文界面

## 安装指南

### 方法一：直接复制（推荐）

1. 将 `addons/threeToTwo` 文件夹复制到您的 Godot 项目的 `addons` 目录下
2. 如果项目中没有 `addons` 目录，请先创建该目录
3. 打开 Godot 编辑器，进入 **项目设置（Project Settings）**
4. 选择 **插件（Plugins）** 选项卡
5. 找到 **ThreeToTwo** 插件并启用它

### 方法二：通过 Godot 资源库

1. 在 Godot 编辑器中打开 **资源库（AssetLib）**
2. 搜索 "ThreeToTwo" 或 "三渲二"
3. 下载并安装插件
4. 在插件设置中启用 ThreeToTwo

## 快速开始

### 第一步：打开插件窗口

1. 启用插件后，Godot 编辑器工具栏会出现 **"3D To 2D"** 按钮
2. 点击该按钮打开 ThreeToTwo 主窗口

### 第二步：导入 3D 模型

1. 在主窗口中点击 **"上传模型"** 按钮
2. 选择您的 3D 模型文件（支持 FBX、GLTF、GLB、OBJ 格式）
3. 等待模型导入完成

### 第三步：调整模型和相机

1. 使用鼠标控制相机：
   - **中键拖动**：旋转相机
   - **右键拖动**：平移相机
   - **滚轮**：缩放相机
2. 使用输入框精确调整模型位置、旋转和缩放

### 第四步：预览和导出

1. 点击 **"预览"** 按钮打开预览面板
2. 在预览面板中调整贴图尺寸和材质
3. 点击相应的导出按钮导出贴图

## 界面详解

### 主窗口布局

主窗口分为以下几个主要区域：

#### 1. 工具栏区域
- **预览按钮**：打开预览面板
- **上传模型按钮**：导入 3D 模型文件
- **语言选择器**：切换界面语言（中文/英文）

#### 2. 相机控制区域
- **位置控制**：X、Y、Z 坐标输入框
- **旋转控制**：X、Y、Z 旋转角度输入框
- **重置相机按钮**：恢复相机到初始位置

#### 3. 模型控制区域
- **位置控制**：模型 X、Y、Z 坐标输入框
- **旋转控制**：模型 X、Y、Z 旋转角度输入框
- **缩放控制**：模型 X、Y、Z 缩放比例输入框
- **统一缩放复选框**：启用/禁用统一缩放模式

#### 4. 环境光控制
- **环境光强度输入框**：调整场景环境光亮度

#### 5. 定向光控制区域
- **灯光开关复选框**：启用/禁用定向光
- **灯光强度输入框**：调整定向光亮度
- **控制灯光复选框**：在相机控制和灯光控制之间切换

#### 6. 动画控制区域
- **播放/暂停按钮**：控制动画播放
- **时间滑块**：拖动调整动画进度
- **循环复选框**：启用/禁用动画循环播放
- **上一帧/下一帧按钮**：逐帧控制动画

### 预览面板布局

预览面板提供贴图预览和导出功能：

#### 1. 预览区域
- **贴图显示**：显示当前渲染的 2D 贴图
- **缩放控制**：支持鼠标滚轮缩放和拖动查看

#### 2. 控制工具栏
- **关闭按钮**：关闭预览面板
- **缩放按钮**：放大、缩小、重置缩放
- **缩放百分比输入框**：精确控制缩放比例

#### 3. 尺寸控制
- **宽度输入框**：设置贴图宽度（像素）
- **高度输入框**：设置贴图高度（像素）

#### 4. 材质控制
- **材质选择器**：在普通材质和法线材质之间切换
- **导出按钮组**：
  - **导出当前贴图**：导出当前显示的贴图
  - **导出普通贴图**：导出普通材质贴图
  - **导出法线贴图**：导出法线材质贴图
  - **导出两种材质**：同时导出普通和法线贴图

#### 5. 动画控制
- **动画选择器**：选择要预览的动画
- **播放控制**：播放/暂停、上一帧、下一帧
- **循环复选框**：启用/禁用动画循环

#### 6. 批量导出
- **间隔时间输入框**：设置批量导出的时间间隔（秒）
- **批量导出按钮**：开始批量导出动画帧

#### 7. 插值算法
- **算法选择器**：选择图像缩放插值算法
  - **Nearest**：最近邻插值（像素化效果）
  - **Bilinear**：双线性插值（平滑效果）
  - **Cubic**：三次插值（更平滑）
  - **Lanczos**：Lanczos 插值（高质量）

## 功能使用详解

### 1. 模型导入

#### 支持的文件格式
- FBX (.fbx)
- GLTF (.gltf)
- GLB (.glb)
- OBJ (.obj)

#### 导入流程
1. 点击 **"上传模型"** 按钮
2. 在文件对话框中选择 3D 模型文件
3. 插件会自动处理导入过程：
   - 检查模型是否已导入
   - 如果未导入，会自动复制文件到项目目录
   - 等待 Godot 完成模型导入
   - 加载模型到预览场景

#### 注意事项
- 首次导入某种格式的模型可能需要较长时间
- 大型模型文件导入时请耐心等待
- 确保模型文件路径不包含中文字符或特殊字符

### 2. 相机控制

#### 鼠标控制
- **中键拖动**：旋转相机视角
- **右键拖动**：平移相机位置
- **滚轮**：放大/缩小视图

#### 键盘控制
- **W/S**：上下移动相机
- **A/D**：左右移动相机
- **Q/E**：前后移动相机
- **小键盘 8/2**：俯仰旋转（上下看）
- **小键盘 4/6**：偏航旋转（左右看）

#### 精确控制
使用输入框可以精确设置相机位置和旋转角度：
- **位置 X/Y/Z**：相机在世界坐标系中的位置
- **旋转 X/Y/Z**：相机的旋转角度（度）

#### 重置功能
点击 **"重置相机"** 按钮可以将相机恢复到初始位置和角度。

### 3. 模型控制

#### 位置调整
- 在 **模型位置** 输入框中输入 X、Y、Z 坐标值
- 支持使用上下箭头键微调（配合 Shift/Ctrl 键调整步长）

#### 旋转调整
- 在 **模型旋转** 输入框中输入 X、Y、Z 旋转角度（度）
- 角度值会实时转换为弧度应用于模型

#### 缩放调整
- 在 **模型缩放** 输入框中输入 X、Y、Z 缩放比例
- **统一缩放模式**：勾选后，修改任一轴缩放会自动同步其他轴
- 默认缩放比例为 1.0（原始大小）

#### 输入框微调技巧
- **直接输入**：在输入框中输入数值后按回车或点击其他地方
- **箭头键微调**：
  - **上下箭头**：以 0.1 为步长调整
  - **Shift + 上下箭头**：以 1.0 为步长调整
  - **Ctrl + 上下箭头**：以 0.01 为步长调整

### 4. 环境光控制

#### 光强度调整
- 在 **环境光强度** 输入框中输入亮度值
- 取值范围：0.0（完全黑暗）到 10.0（非常明亮）
- 默认值：1.0

#### 效果说明
- 环境光影响整个场景的亮度
- 调整环境光可以改变贴图的明暗效果
- 建议根据模型材质和所需效果调整

### 5. 动画控制

#### 动画播放
1. 导入包含动画的模型后，**动画选择器** 中会显示可用动画列表
2. 选择要播放的动画
3. 点击 **播放** 按钮开始播放动画
4. 使用 **暂停** 按钮暂停播放

#### 进度控制
- **时间滑块**：拖动滑块可以跳转到动画的任意时间点
- **时间输入框**：输入精确的时间值（秒）定位动画
- **上一帧/下一帧按钮**：以 0.01 秒为步长逐帧控制

#### 循环播放
- 勾选 **循环** 复选框后，动画播放到结尾会自动重新开始
- 取消勾选则播放一次后停止

#### 动画导出
在预览面板中，可以导出动画的任意帧作为贴图。

### 6. 预览面板使用

#### 打开预览
1. 在主窗口中调整好模型和相机位置
2. 点击 **"预览"** 按钮打开预览面板
3. 预览面板会显示当前视角下的 2D 贴图

#### 贴图缩放
- **鼠标滚轮**：放大/缩小贴图
- **缩放按钮**：放大、缩小、重置缩放
- **缩放输入框**：输入百分比精确控制（如 150% 表示 1.5 倍缩放）
- **中键拖动**：在放大状态下拖动查看贴图不同部分

#### 尺寸设置
- **宽度**：设置导出贴图的宽度（像素）
- **高度**：设置导出贴图的高度（像素）
- 修改尺寸后，预览贴图会实时更新

#### 材质切换
- **普通材质**：显示模型的原始材质效果
- **法线材质**：显示模型的法线贴图效果（用于特殊渲染）
- 切换材质后，预览贴图会立即更新

### 7. 贴图导出

#### 单张导出
1. 在预览面板中调整好贴图尺寸和材质
2. 点击相应的导出按钮：
   - **导出当前贴图**：导出当前显示的贴图
   - **导出普通贴图**：切换到普通材质并导出
   - **导出法线贴图**：切换到法线材质并导出
   - **导出两种材质**：同时导出普通和法线贴图
3. 在文件对话框中选择保存位置和文件名
4. 贴图将以 PNG 格式保存

#### 导出设置
- **文件名自动生成**：基于动画名和导出序号自动生成文件名
- **格式固定**：始终导出为 PNG 格式，支持透明通道
- **尺寸保持**：保持预览时设置的尺寸

### 8. 批量导出

#### 批量导出流程
1. 在预览面板的 **批量导出** 区域设置时间间隔（秒）
2. 点击 **"批量导出"** 按钮
3. 在文件对话框中选择保存目录和文件名前缀
4. 插件会自动：
   - 创建以文件名前缀命名的目录
   - 在目录下创建 "普通贴图" 和 "法线贴图" 子目录
   - 按时间间隔导出动画的每一帧
   - 分别保存普通材质和法线材质的贴图

#### 批量导出设置
- **时间间隔**：导出帧之间的时间间隔（秒）
  - 例如：设置为 0.5 表示每 0.5 秒导出一帧
  - 设置为 1.0 表示每秒导出一帧
- **导出范围**：从动画开始到结束的所有帧
- **文件命名**：`前缀_序号.png` 和 `前缀_Normal_序号.png`

#### 批量导出用途
- 制作精灵动画（Sprite Animation）
- 创建动画序列帧
- 生成角色动作资源
- 制作特效序列图

### 9. 插值算法选择

#### 可用的插值算法
1. **Nearest（最近邻）**
   - 效果：像素化，保持硬边缘
   - 适用：像素艺术、复古风格
   - 性能：最快

2. **Bilinear（双线性）**
   - 效果：平滑，中等质量
   - 适用：一般用途，平衡质量和性能
   - 性能：较快

3. **Cubic（三次）**
   - 效果：更平滑，高质量
   - 适用：需要高质量缩放的场景
   - 性能：较慢

4. **Lanczos**
   - 效果：最高质量，锐利清晰
   - 适用：专业用途，需要最佳质量
   - 性能：最慢

#### 选择建议
- 小尺寸贴图放大：使用 **Lanczos** 或 **Cubic** 保持清晰度
- 大尺寸贴图缩小：使用 **Bilinear** 平衡质量和性能
- 像素艺术风格：使用 **Nearest** 保持像素感
- 一般游戏资源：使用 **Bilinear** 或 **Cubic**

### 10. 定向光控制

#### 灯光开关
- 勾选 **"灯光"** 复选框启用定向光
- 取消勾选禁用定向光
- 定向光影响场景的照明和阴影效果

#### 灯光强度调整
- 在 **"灯光强度"** 输入框中输入亮度值
- 取值范围：0.0（无光）到 16.0（非常明亮）
- 默认值：1.0

#### 控制模式切换
- 勾选 **"控制灯光"** 复选框切换到灯光控制模式
- 在灯光控制模式下：
  - 界面标签从"相机"变为"灯光"
  - 鼠标中键拖动旋转灯光而非相机
  - 输入框控制灯光位置和旋转而非相机
- 取消勾选返回相机控制模式

#### 灯光旋转控制
- 在灯光控制模式下，使用鼠标中键拖动旋转灯光
- 使用输入框精确设置灯光位置和旋转角度
- 点击 **"重置"** 按钮将灯光恢复到初始位置和旋转

## 高级功能

### 1. 多语言支持

插件支持中文和英文界面：
- 在主窗口的 **语言选择器** 中切换语言
- 切换后所有界面文本会立即更新
- 语言设置会保存，下次打开时保持相同语言

### 2. 输入框高级操作

#### 焦点管理
- 点击输入框外部可以释放所有输入框焦点
- 输入框获得焦点时，相机键盘控制会暂时禁用
- 失去焦点后，相机控制自动恢复

#### 数值微调
所有数值输入框都支持：
- 直接输入数值
- 上下箭头键微调
- 配合修饰键调整步长
- 回车键确认输入

### 3. 模型材质系统

#### 普通材质
- 使用模型的原始材质
- 显示模型的纹理和颜色
- 适合大多数导出需求

#### 法线材质
- 使用特殊的法线着色器
- 显示模型的法线信息
- 输出 RGB 颜色表示法线方向
- 用于特殊渲染效果或后期处理

#### 材质切换原理
- 切换材质时，插件会为所有网格实例应用相应的材质
- 法线材质模式下，会显示一个紫色背景的法线网格
- 切换过程完全自动化，无需手动操作

### 4. 相机参数配置

在相机控制脚本中，可以调整以下参数（需要编辑代码）：

```gdscript
@export var rotationSpeed: float = 1.0      # 旋转速度
@export var zoomSpeed: float = 1.0          # 缩放速度
@export var panSpeed: float = 0.5           # 平移速度
@export var minZoom: float = 1.0            # 最小缩放距离
@export var maxZoom: float = 20.0           # 最大缩放距离
@export var autoRotateSpeed: float = 0.5    # 自动旋转速度
@export var keyboardMoveSpeed: float = 1.0  # 键盘移动速度
@export var keyboardRotateSpeed: float = 0.1 # 键盘旋转速度
@export var keyboardVerticalSpeed: float = 1.0 # 键盘垂直速度
```

## 快捷键参考

### 主窗口快捷键

#### 相机控制
- **鼠标中键拖动**：旋转相机
- **鼠标右键拖动**：平移相机
- **鼠标滚轮**：缩放相机
- **W/S**：上下移动相机
- **A/D**：左右移动相机
- **Q/E**：前后移动相机
- **小键盘 8/2**：俯仰旋转
- **小键盘 4/6**：偏航旋转

#### 输入框操作
- **回车键**：确认输入
- **上下箭头**：以 0.1 步长调整数值
- **Shift + 上下箭头**：以 1.0 步长调整数值
- **Ctrl + 上下箭头**：以 0.01 步长调整数值
- **点击外部**：释放输入框焦点

### 预览面板快捷键

#### 贴图查看
- **鼠标滚轮**：缩放贴图
- **鼠标中键拖动**：拖动查看贴图（缩放状态下）
- **Ctrl + 鼠标滚轮**：快速缩放

#### 动画控制
- **空格键**：播放/暂停动画
- **左箭头**：上一帧（0.01秒）
- **右箭头**：下一帧（0.01秒）

## 常见问题

### Q1: 导入模型时提示错误怎么办？
**A:** 请检查以下事项：
1. 模型文件格式是否受支持（FBX、GLTF、GLB、OBJ）
2. 模型文件路径是否包含中文字符或特殊字符
3. 模型文件是否损坏
4. Godot 是否安装了相应的模型导入器

### Q2: 导出的贴图尺寸不正确？
**A:** 请检查：
1. 预览面板中的宽度和高度设置
2. 是否在导出前修改了尺寸但未点击其他地方确认
3. 尝试点击输入框外部或按回车键确认尺寸

### Q3: 法线材质显示为紫色？
**A:** 这是正常现象：
1. 法线材质使用特殊的着色器渲染法线信息
2. 紫色背景是法线着色器的默认颜色
3. 当模型有法线信息时，会显示为彩色法线贴图
4. 如果模型没有法线信息，会保持紫色背景

### Q4: 批量导出时卡住或停止？
**A:** 可能的原因和解决方法：
1. **动画太长**：减少时间间隔或导出范围
2. **贴图尺寸太大**：减小宽度和高度设置
3. **磁盘空间不足**：检查保存目录的可用空间
4. **文件权限问题**：确保有写入权限
5. **尝试重新启动插件**：关闭并重新打开插件窗口

### Q5: 插件窗口无法打开？
**A:** 请尝试以下步骤：
1. 检查插件是否已正确启用
2. 重启 Godot 编辑器
3. 检查 Godot 版本是否兼容（建议 Godot 4.0+）
4. 查看控制台是否有错误信息

### Q6: 如何调整插件窗口大小？
**A:** 插件窗口支持调整大小：
1. 拖动窗口边缘或角落调整大小
2. 最小尺寸为 800×600 像素
3. 窗口大小会自动保存，下次打开时保持相同尺寸

### Q7: 导出的贴图有黑边或透明区域？
**A:** 这可能是因为：
1. **模型位置不当**：调整模型位置使其在相机视野中心
2. **相机距离太远**：缩小相机距离
3. **模型尺寸太小**：增大模型缩放比例
4. **背景设置**：检查环境设置是否有透明背景

## 技术支持

### 获取帮助
如果您遇到问题或需要帮助：
1. **查看本文档**：首先查阅本使用手册的相关章节
2. **检查控制台**：Godot 编辑器的输出面板可能有错误信息
3. **联系开发者**：通过插件发布页面联系开发者
4. **社区支持**：在 Godot 中文社区或相关论坛提问

### 报告问题
报告问题时请提供以下信息：
1. Godot 版本号
2. 插件版本号
3. 操作系统和版本
4. 问题的详细描述
5. 重现问题的步骤
6. 相关的错误信息或截图

### 更新日志
请查看插件的更新日志了解最新功能和修复。

## 结语

ThreeToTwo 插件为 Godot 开发者提供了一个强大的三渲二工具，简化了从 3D 模型到 2D 贴图的转换过程。无论您是制作 2D 游戏需要角色精灵，还是需要将 3D 资源转换为 2D 资源，这个插件都能帮助您高效完成工作。

如果您有任何建议或反馈，欢迎联系开发者。祝您使用愉快！

## 许可证

本插件基于 Apache 许可证 2.0 提供。详情请参阅 LICENSE 文件。

---
*最后更新：2025年12月*
*Youhua_Uncle（游画大叔）*
